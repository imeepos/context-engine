# å‡ ä½•çŸ¥è¯†æ‰©å±•è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç°çŠ¶åˆ†æ](#é¡¹ç›®ç°çŠ¶åˆ†æ)
2. [æ‰©å±•ç›®æ ‡](#æ‰©å±•ç›®æ ‡)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
5. [è®¡ç®—å¼•æ“æ‰©å±•](#è®¡ç®—å¼•æ“æ‰©å±•)
6. [UI/UX è®¾è®¡](#uiux-è®¾è®¡)
7. [äº¤äº’æµç¨‹è®¾è®¡](#äº¤äº’æµç¨‹è®¾è®¡)
8. [å®ç°è·¯çº¿å›¾](#å®ç°è·¯çº¿å›¾)

---

## 1. é¡¹ç›®ç°çŠ¶åˆ†æ

### å½“å‰åŠŸèƒ½èŒƒå›´
- âœ… ä¸‰è§’å½¢çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- âœ… ä¸‰è§’å½¢å±æ€§è®¡ç®—ï¼ˆè¾¹é•¿ã€è§’åº¦ã€é¢ç§¯ã€å‘¨é•¿ï¼‰
- âœ… è¾…åŠ©çº¿ï¼ˆä¸­çº¿ã€é«˜çº¿ã€è§’å¹³åˆ†çº¿ã€ä¸­ä½çº¿ï¼‰
- âœ… ç‰¹æ®Šç‚¹ï¼ˆé‡å¿ƒã€å‚å¿ƒã€å†…å¿ƒã€å¤–å¿ƒï¼‰
- âœ… å…¨ç­‰å’Œç›¸ä¼¼åˆ¤å®š
- âœ… 7 ä¸ªçŸ¥è¯†æ¨¡å—ï¼ˆåˆä¸€åˆ°åˆä¸‰ï¼‰

### å½“å‰æ¶æ„ä¼˜åŠ¿
1. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**ï¼šå¼•æ“å±‚ã€çŠ¶æ€å±‚ã€UIå±‚åˆ†ç¦»
2. **å¯æ‰©å±•çš„ç±»å‹ç³»ç»Ÿ**ï¼šTypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥
3. **çµæ´»çš„çŠ¶æ€ç®¡ç†**ï¼šZustand å¤š store è®¾è®¡
4. **é«˜æ€§èƒ½æ¸²æŸ“**ï¼šReact Konva å¤šå›¾å±‚æ¶æ„
5. **å®Œå–„çš„æµ‹è¯•è¦†ç›–**ï¼šæ ¸å¿ƒè®¡ç®—å¼•æ“æœ‰å•å…ƒæµ‹è¯•

### å½“å‰é™åˆ¶
- âŒ åªæ”¯æŒä¸‰è§’å½¢ï¼Œæ— æ³•å­¦ä¹ å…¶ä»–å‡ ä½•å›¾å½¢
- âŒ ç¼ºå°‘åŸºç¡€å‡ ä½•å…ƒç´ ï¼ˆç‚¹ã€çº¿ã€é¢ï¼‰çš„ç‹¬ç«‹æ“ä½œ
- âŒ æ— æ³•åˆ›å»ºå¤æ‚å¤šè¾¹å½¢å’Œåœ†å½¢
- âŒ çŸ¥è¯†æ¨¡å—å±€é™äºä¸‰è§’å½¢ç›¸å…³å†…å®¹

---

## 2. æ‰©å±•ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
å°† **triangle-geometry** å‡çº§ä¸º **geometry-learning-platform**ï¼Œæ”¯æŒå®Œæ•´çš„å¹³é¢å‡ ä½•å­¦ä¹ ä½“ç³»ã€‚

### å‡ ä½•å…ƒç´ æ‰©å±•

| ç±»åˆ« | å…ƒç´  | ä¼˜å…ˆçº§ | å­¦ä¹ é˜¶æ®µ |
|------|------|--------|----------|
| **åŸºç¡€å…ƒç´ ** | ç‚¹ (Point) | P0 | å°å­¦/åˆä¸€ |
| | çº¿æ®µ (Segment) | P0 | å°å­¦/åˆä¸€ |
| | å°„çº¿ (Ray) | P1 | åˆä¸€ |
| | ç›´çº¿ (Line) | P1 | åˆä¸€ |
| **ä¸‰è§’å½¢** | æ™®é€šä¸‰è§’å½¢ | âœ… å·²å®Œæˆ | åˆä¸€-åˆä¸‰ |
| **å››è¾¹å½¢** | å¹³è¡Œå››è¾¹å½¢ | P0 | åˆäºŒ |
| | çŸ©å½¢ | P0 | åˆäºŒ |
| | è±å½¢ | P0 | åˆäºŒ |
| | æ­£æ–¹å½¢ | P0 | åˆäºŒ |
| | æ¢¯å½¢ | P1 | åˆäºŒ |
| **å¤šè¾¹å½¢** | æ­£å¤šè¾¹å½¢ (nè¾¹å½¢) | P1 | åˆä¸‰ |
| | ä¸è§„åˆ™å¤šè¾¹å½¢ | P2 | åˆä¸‰ |
| **åœ†å½¢** | åœ† (Circle) | P0 | åˆä¸‰ |
| | æ‰‡å½¢ (Sector) | P1 | åˆä¸‰ |
| | å¼“å½¢ (Segment) | P2 | åˆä¸‰ |
| **å¤åˆå›¾å½¢** | åœ†ä¸å¤šè¾¹å½¢ç»„åˆ | P2 | åˆä¸‰/é«˜ä¸­ |

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å‡çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (App Layer)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Canvas UI   â”‚  â”‚  Panel UI    â”‚  â”‚  Toolbar UI  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   çŠ¶æ€ç®¡ç†å±‚ (State Layer)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Shape Store  â”‚  â”‚ Canvas Store â”‚  â”‚ Module Store â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è®¡ç®—å¼•æ“å±‚ (Engine Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Point Engine â”‚  â”‚ Line Engine  â”‚  â”‚ Shape Engine â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Triangle Eng â”‚  â”‚ Quad Engine  â”‚  â”‚ Circle Engineâ”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Polygon Eng  â”‚  â”‚ Transform Engâ”‚  â”‚ Relation Eng â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€çš„å›¾å½¢æŠ½è±¡**ï¼šæ‰€æœ‰å›¾å½¢ç»§æ‰¿è‡ª `BaseShape` æ¥å£
2. **å¯ç»„åˆçš„è®¡ç®—å¼•æ“**ï¼šæ¯ä¸ªå¼•æ“ä¸“æ³¨äºç‰¹å®šå‡ ä½•è®¡ç®—
3. **åˆ†ç¦»çš„æ¸²æŸ“å±‚**ï¼šæ¯ç§å›¾å½¢æœ‰ç‹¬ç«‹çš„ Konva Layer
4. **æ¨¡å—åŒ–çš„çŸ¥è¯†ä½“ç³»**ï¼šçŸ¥è¯†æ¨¡å—æŒ‰å¹´çº§å’Œä¸»é¢˜ç»„ç»‡

---

## 4. æ•°æ®æ¨¡å‹è®¾è®¡

### 4.1 åŸºç¡€ç±»å‹å®šä¹‰

```typescript
// src/types/geometry-base.ts

/** åŸºç¡€ç‚¹ç±»å‹ */
interface Point {
  x: number
  y: number
  id?: string
  label?: string
}

/** å›¾å½¢åŸºç±» */
interface BaseShape {
  id: string
  type: ShapeType
  visible: boolean
  locked: boolean
  color: string
  opacity: number
  zIndex: number
  metadata?: Record<string, any>
}

/** å›¾å½¢ç±»å‹æšä¸¾ */
type ShapeType =
  | 'point'
  | 'segment'
  | 'ray'
  | 'line'
  | 'triangle'
  | 'quadrilateral'
  | 'polygon'
  | 'circle'
  | 'arc'
  | 'sector'

/** æ ‡ç­¾é…ç½® */
interface LabelConfig {
  text: string
  visible: boolean
  position: 'auto' | 'top' | 'bottom' | 'left' | 'right'
  offset: { x: number; y: number }
}
```

### 4.2 å…·ä½“å›¾å½¢ç±»å‹

```typescript
// src/types/shapes.ts

/** ç‚¹ */
interface PointShape extends BaseShape {
  type: 'point'
  position: Point
  label: LabelConfig
  style: {
    radius: number
    fill: string
    stroke: string
  }
}

/** çº¿æ®µ */
interface SegmentShape extends BaseShape {
  type: 'segment'
  start: Point
  end: Point
  label: LabelConfig
  style: {
    strokeWidth: number
    dash?: number[]
  }
  measurements: {
    length: number
    midpoint: Point
  }
}

/** å°„çº¿ */
interface RayShape extends BaseShape {
  type: 'ray'
  origin: Point
  direction: Point  // æ–¹å‘ç‚¹
  label: LabelConfig
}

/** ç›´çº¿ */
interface LineShape extends BaseShape {
  type: 'line'
  point1: Point
  point2: Point  // ç”¨ä¸¤ç‚¹ç¡®å®šç›´çº¿
  label: LabelConfig
  equation?: {
    slope: number | 'vertical'
    intercept: number
    standard: string  // Ax + By + C = 0
  }
}

/** ä¸‰è§’å½¢ (å·²æœ‰ï¼Œéœ€è¦é€‚é…æ–°æ¥å£) */
interface TriangleShape extends BaseShape {
  type: 'triangle'
  vertices: [Point, Point, Point]
  labels: [LabelConfig, LabelConfig, LabelConfig]
  auxiliaryLines: AuxiliaryLine[]
  properties: TriangleProperties
}

/** å››è¾¹å½¢ */
interface QuadrilateralShape extends BaseShape {
  type: 'quadrilateral'
  vertices: [Point, Point, Point, Point]
  labels: [LabelConfig, LabelConfig, LabelConfig, LabelConfig]
  quadType: 'parallelogram' | 'rectangle' | 'rhombus' | 'square' | 'trapezoid' | 'general'
  properties: QuadrilateralProperties
  diagonals?: {
    AC: { visible: boolean; length: number }
    BD: { visible: boolean; length: number }
    intersection: Point | null
  }
}

/** å¤šè¾¹å½¢ */
interface PolygonShape extends BaseShape {
  type: 'polygon'
  vertices: Point[]  // nä¸ªé¡¶ç‚¹
  labels: LabelConfig[]
  closed: boolean
  polygonType: 'regular' | 'irregular'
  properties: PolygonProperties
}

/** åœ† */
interface CircleShape extends BaseShape {
  type: 'circle'
  center: Point
  radius: number
  label: LabelConfig
  style: {
    fill: string
    stroke: string
    strokeWidth: number
  }
  properties: CircleProperties
  annotations?: {
    showRadius: boolean
    showDiameter: boolean
    showCenter: boolean
  }
}

/** æ‰‡å½¢ */
interface SectorShape extends BaseShape {
  type: 'sector'
  center: Point
  radius: number
  startAngle: number  // å¼§åº¦
  endAngle: number    // å¼§åº¦
  properties: {
    arcLength: number
    area: number
    centralAngle: number
  }
}

/** è”åˆç±»å‹ */
type Shape =
  | PointShape
  | SegmentShape
  | RayShape
  | LineShape
  | TriangleShape
  | QuadrilateralShape
  | PolygonShape
  | CircleShape
  | SectorShape
```

### 4.3 å±æ€§è®¡ç®—ç±»å‹

```typescript
// src/types/properties.ts

/** å››è¾¹å½¢å±æ€§ */
interface QuadrilateralProperties {
  sideLengths: { AB: number; BC: number; CD: number; DA: number }
  angles: { A: number; B: number; C: number; D: number }
  diagonals: { AC: number; BD: number }
  perimeter: number
  area: number
  isParallelogram: boolean
  isRectangle: boolean
  isRhombus: boolean
  isSquare: boolean
  isTrapezoid: boolean
}

/** å¤šè¾¹å½¢å±æ€§ */
interface PolygonProperties {
  sideCount: number
  sideLengths: number[]
  angles: number[]
  perimeter: number
  area: number
  isConvex: boolean
  isRegular: boolean
  interiorAngleSum: number
  exteriorAngleSum: number
  apothem?: number  // è¾¹å¿ƒè·ï¼ˆæ­£å¤šè¾¹å½¢ï¼‰
}

/** åœ†å±æ€§ */
interface CircleProperties {
  radius: number
  diameter: number
  circumference: number
  area: number
}
```

---

## 5. è®¡ç®—å¼•æ“æ‰©å±•

### 5.1 å¼•æ“æ¨¡å—ç»„ç»‡

```
src/engine/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ point.ts              # ç‚¹çš„åŸºç¡€è¿ç®—
â”‚   â”œâ”€â”€ vector.ts             # å‘é‡è¿ç®—
â”‚   â”œâ”€â”€ line.ts               # ç›´çº¿/çº¿æ®µ/å°„çº¿è¿ç®—
â”‚   â””â”€â”€ transform.ts          # å‡ ä½•å˜æ¢
â”œâ”€â”€ shapes/
â”‚   â”œâ”€â”€ triangle.ts           # âœ… å·²æœ‰
â”‚   â”œâ”€â”€ quadrilateral.ts      # å››è¾¹å½¢è®¡ç®—
â”‚   â”œâ”€â”€ polygon.ts            # å¤šè¾¹å½¢è®¡ç®—
â”‚   â””â”€â”€ circle.ts             # åœ†å½¢è®¡ç®—
â”œâ”€â”€ relations/
â”‚   â”œâ”€â”€ distance.ts           # è·ç¦»å…³ç³»
â”‚   â”œâ”€â”€ angle.ts              # è§’åº¦å…³ç³»
â”‚   â”œâ”€â”€ parallel.ts           # å¹³è¡Œå…³ç³»
â”‚   â”œâ”€â”€ perpendicular.ts      # å‚ç›´å…³ç³»
â”‚   â””â”€â”€ intersection.ts       # ç›¸äº¤å…³ç³»
â”œâ”€â”€ properties/
â”‚   â”œâ”€â”€ triangle-properties.ts    # âœ… å·²æœ‰
â”‚   â”œâ”€â”€ quad-properties.ts        # å››è¾¹å½¢å±æ€§
â”‚   â”œâ”€â”€ polygon-properties.ts     # å¤šè¾¹å½¢å±æ€§
â”‚   â””â”€â”€ circle-properties.ts      # åœ†å±æ€§
â””â”€â”€ advanced/
    â”œâ”€â”€ congruence.ts         # âœ… å·²æœ‰
    â”œâ”€â”€ similarity.ts         # âœ… å·²æœ‰
    â”œâ”€â”€ symmetry.ts           # å¯¹ç§°æ€§åˆ¤å®š
    â””â”€â”€ tangency.ts           # åˆ‡çº¿å…³ç³»
```

### 5.2 æ ¸å¿ƒå¼•æ“å®ç°ç¤ºä¾‹

#### å››è¾¹å½¢å¼•æ“

```typescript
// src/engine/shapes/quadrilateral.ts

import { Point } from '@/types/geometry-base'
import { QuadrilateralProperties } from '@/types/properties'
import { distance, angle } from '@/engine/core/point'
import { lineIntersection } from '@/engine/core/line'

/**
 * è®¡ç®—å››è¾¹å½¢çš„å®Œæ•´å±æ€§
 */
export function calculateQuadProperties(
  vertices: [Point, Point, Point, Point]
): QuadrilateralProperties {
  const [A, B, C, D] = vertices

  // è¾¹é•¿
  const AB = distance(A, B)
  const BC = distance(B, C)
  const CD = distance(C, D)
  const DA = distance(D, A)

  // å¯¹è§’çº¿
  const AC = distance(A, C)
  const BD = distance(B, D)

  // å†…è§’
  const angleA = angle(D, A, B)
  const angleB = angle(A, B, C)
  const angleC = angle(B, C, D)
  const angleD = angle(C, D, A)

  // å‘¨é•¿å’Œé¢ç§¯
  const perimeter = AB + BC + CD + DA
  const area = calculateQuadArea(vertices)

  // åˆ¤å®šç‰¹æ®Šå››è¾¹å½¢
  const isParallelogram = checkParallelogram(vertices)
  const isRectangle = checkRectangle(vertices, isParallelogram)
  const isRhombus = checkRhombus(vertices, isParallelogram)
  const isSquare = isRectangle && isRhombus
  const isTrapezoid = checkTrapezoid(vertices)

  return {
    sideLengths: { AB, BC, CD, DA },
    angles: {
      A: angleA,
      B: angleB,
      C: angleC,
      D: angleD
    },
    diagonals: { AC, BD },
    perimeter,
    area,
    isParallelogram,
    isRectangle,
    isRhombus,
    isSquare,
    isTrapezoid,
  }
}

/**
 * ä½¿ç”¨é‹å¸¦å…¬å¼è®¡ç®—å››è¾¹å½¢é¢ç§¯
 */
function calculateQuadArea(vertices: [Point, Point, Point, Point]): number {
  const [A, B, C, D] = vertices
  return Math.abs(
    (A.x * B.y - B.x * A.y) +
    (B.x * C.y - C.x * B.y) +
    (C.x * D.y - D.x * C.y) +
    (D.x * A.y - A.x * D.y)
  ) / 2
}

/**
 * åˆ¤å®šå¹³è¡Œå››è¾¹å½¢ï¼šå¯¹è¾¹å¹³è¡Œä¸”ç›¸ç­‰
 */
function checkParallelogram(vertices: [Point, Point, Point, Point]): boolean {
  const [A, B, C, D] = vertices

  // å¯¹è¾¹ç›¸ç­‰
  const AB = distance(A, B)
  const CD = distance(C, D)
  const BC = distance(B, C)
  const DA = distance(D, A)

  const tolerance = 0.01
  return (
    Math.abs(AB - CD) < tolerance &&
    Math.abs(BC - DA) < tolerance
  )
}

/**
 * åˆ¤å®šçŸ©å½¢ï¼šå¹³è¡Œå››è¾¹å½¢ + ä¸€ä¸ªç›´è§’
 */
function checkRectangle(
  vertices: [Point, Point, Point, Point],
  isParallelogram: boolean
): boolean {
  if (!isParallelogram) return false

  const [A, B, C] = vertices
  const angleABC = angle(A, B, C)

  return Math.abs(angleABC - Math.PI / 2) < 0.01
}

/**
 * åˆ¤å®šè±å½¢ï¼šå¹³è¡Œå››è¾¹å½¢ + å››è¾¹ç›¸ç­‰
 */
function checkRhombus(
  vertices: [Point, Point, Point, Point],
  isParallelogram: boolean
): boolean {
  if (!isParallelogram) return false

  const [A, B, C, D] = vertices
  const AB = distance(A, B)
  const BC = distance(B, C)
  const CD = distance(C, D)
  const DA = distance(D, A)

  const tolerance = 0.01
  return (
    Math.abs(AB - BC) < tolerance &&
    Math.abs(BC - CD) < tolerance &&
    Math.abs(CD - DA) < tolerance
  )
}

/**
 * åˆ¤å®šæ¢¯å½¢ï¼šä¸€ç»„å¯¹è¾¹å¹³è¡Œ
 */
function checkTrapezoid(vertices: [Point, Point, Point, Point]): boolean {
  // æ£€æŸ¥ AB || CD æˆ– BC || DA
  // ä½¿ç”¨å‘é‡å‰ç§¯åˆ¤å®šå¹³è¡Œ
  const [A, B, C, D] = vertices

  const AB = { x: B.x - A.x, y: B.y - A.y }
  const CD = { x: D.x - C.x, y: D.y - C.y }
  const BC = { x: C.x - B.x, y: C.y - B.y }
  const DA = { x: A.x - D.x, y: A.y - D.y }

  const cross1 = Math.abs(AB.x * CD.y - AB.y * CD.x)
  const cross2 = Math.abs(BC.x * DA.y - BC.y * DA.x)

  const tolerance = 0.01
  return cross1 < tolerance || cross2 < tolerance
}
```

#### åœ†å½¢å¼•æ“

```typescript
// src/engine/shapes/circle.ts

import { Point } from '@/types/geometry-base'
import { CircleProperties } from '@/types/properties'
import { distance } from '@/engine/core/point'

/**
 * è®¡ç®—åœ†çš„å±æ€§
 */
export function calculateCircleProperties(
  center: Point,
  radius: number
): CircleProperties {
  return {
    radius,
    diameter: radius * 2,
    circumference: 2 * Math.PI * radius,
    area: Math.PI * radius * radius,
  }
}

/**
 * é€šè¿‡ä¸‰ç‚¹ç¡®å®šåœ†
 * è¿”å›åœ†å¿ƒå’ŒåŠå¾„
 */
export function circleFromThreePoints(
  p1: Point,
  p2: Point,
  p3: Point
): { center: Point; radius: number } | null {
  // ä½¿ç”¨å¤–æ¥åœ†ç®—æ³•
  const ax = p1.x
  const ay = p1.y
  const bx = p2.x
  const by = p2.y
  const cx = p3.x
  const cy = p3.y

  const d = 2 * (ax * (by - cy) + bx * (cy - ay) + cx * (ay - by))

  if (Math.abs(d) < 0.0001) {
    return null // ä¸‰ç‚¹å…±çº¿
  }

  const ux = ((ax * ax + ay * ay) * (by - cy) +
              (bx * bx + by * by) * (cy - ay) +
              (cx * cx + cy * cy) * (ay - by)) / d

  const uy = ((ax * ax + ay * ay) * (cx - bx) +
              (bx * bx + by * by) * (ax - cx) +
              (cx * cx + cy * cy) * (bx - ax)) / d

  const center = { x: ux, y: uy }
  const radius = distance(center, p1)

  return { center, radius }
}

/**
 * åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨åœ†å†…
 */
export function isPointInCircle(
  point: Point,
  center: Point,
  radius: number
): boolean {
  return distance(point, center) <= radius
}

/**
 * åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨åœ†ä¸Š
 */
export function isPointOnCircle(
  point: Point,
  center: Point,
  radius: number,
  tolerance = 0.01
): boolean {
  const dist = distance(point, center)
  return Math.abs(dist - radius) < tolerance
}

/**
 * è®¡ç®—åœ†ä¸ç›´çº¿çš„äº¤ç‚¹
 */
export function circleLineIntersection(
  center: Point,
  radius: number,
  lineStart: Point,
  lineEnd: Point
): Point[] {
  // ä½¿ç”¨å‚æ•°æ–¹ç¨‹æ±‚è§£
  const dx = lineEnd.x - lineStart.x
  const dy = lineEnd.y - lineStart.y
  const fx = lineStart.x - center.x
  const fy = lineStart.y - center.y

  const a = dx * dx + dy * dy
  const b = 2 * (fx * dx + fy * dy)
  const c = fx * fx + fy * fy - radius * radius

  const discriminant = b * b - 4 * a * c

  if (discriminant < 0) {
    return [] // æ— äº¤ç‚¹
  }

  const t1 = (-b - Math.sqrt(discriminant)) / (2 * a)
  const t2 = (-b + Math.sqrt(discriminant)) / (2 * a)

  const intersections: Point[] = []

  if (t1 >= 0 && t1 <= 1) {
    intersections.push({
      x: lineStart.x + t1 * dx,
      y: lineStart.y + t1 * dy,
    })
  }

  if (t2 >= 0 && t2 <= 1 && Math.abs(t1 - t2) > 0.0001) {
    intersections.push({
      x: lineStart.x + t2 * dx,
      y: lineStart.y + t2 * dy,
    })
  }

  return intersections
}

/**
 * è®¡ç®—ä¸¤åœ†çš„äº¤ç‚¹
 */
export function circleCir