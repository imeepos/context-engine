# 实现路线图

## 📅 分阶段实施计划

### 阶段 0: 架构重构 (1-2 周)

**目标**: 为多图形支持做好架构准备

#### 任务清单

- [ ] **重构类型系统**
  - [ ] 创建 `src/types/geometry-base.ts` - 基础类型定义
  - [ ] 创建 `src/types/shapes.ts` - 所有图形类型
  - [ ] 创建 `src/types/properties.ts` - 属性计算类型
  - [ ] 迁移现有 Triangle 类型到新架构

- [ ] **重构状态管理**
  - [ ] 将 `triangle-store.ts` 重构为 `shape-store.ts`
  - [ ] 支持多种图形类型的统一管理
  - [ ] 保持向后兼容（三角形功能不受影响）

- [ ] **重构计算引擎**
  - [ ] 创建 `src/engine/core/` 目录
  - [ ] 提取通用几何计算到 core
  - [ ] 将现有三角形引擎移到 `src/engine/shapes/triangle.ts`

- [ ] **重构渲染层**
  - [ ] 创建 `ShapeLayer` 基类
  - [ ] 重构 `TriangleLayer` 继承 `ShapeLayer`
  - [ ] 准备多图形渲染架构

**验收标准**:
- ✅ 所有现有三角形功能正常工作
- ✅ 类型检查通过 (`pnpm run check-types`)
- ✅ 所有测试通过 (`pnpm run test`)
- ✅ 代码质量检查通过 (`pnpm run lint`)

---

### 阶段 1: 基础元素支持 (1 周)

**目标**: 支持点和线段的创建与操作

#### 1.1 点 (Point) 支持

- [ ] **数据模型**
  - [ ] 定义 `PointShape` 类型
  - [ ] 在 `shape-store` 中添加点管理

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/core/point.ts`
  - [ ] 实现点的基础运算（距离、中点等）

- [ ] **UI 组件**
  - [ ] 在 `ShapePicker` 中添加"点"按钮
  - [ ] 创建 `PointLayer.tsx` 渲染点
  - [ ] 创建 `PointInfoPanel.tsx` 显示点属性

- [ ] **交互逻辑**
  - [ ] 实现点的创建（点击画布）
  - [ ] 实现点的拖动
  - [ ] 实现点的选中/删除

- [ ] **测试**
  - [ ] 单元测试: `point.test.ts`
  - [ ] 集成测试: 点的创建和编辑

#### 1.2 线段 (Segment) 支持

- [ ] **数据模型**
  - [ ] 定义 `SegmentShape` 类型
  - [ ] 在 `shape-store` 中添加线段管理

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/core/line.ts`
  - [ ] 实现线段计算（长度、斜率、中点、垂足等）

- [ ] **UI 组件**
  - [ ] 在 `ShapePicker` 中添加"线段"按钮
  - [ ] 创建 `SegmentLayer.tsx` 渲染线段
  - [ ] 创建 `SegmentInfoPanel.tsx` 显示线段属性

- [ ] **交互逻辑**
  - [ ] 实现线段的创建（点击两个点）
  - [ ] 实现线段端点的拖动
  - [ ] 实现线段的选中/删除
  - [ ] 显示长度标注

- [ ] **辅助工具**
  - [ ] 显示中点
  - [ ] 显示垂直平分线
  - [ ] 测量角度（两条线段）

- [ ] **测试**
  - [ ] 单元测试: `line.test.ts`
  - [ ] 集成测试: 线段的创建和编辑

**验收标准**:
- ✅ 可以创建、编辑、删除点和线段
- ✅ 点和线段的属性正确计算和显示
- ✅ 所有测试通过
- ✅ 与现有三角形功能无冲突

---

### 阶段 2: 四边形支持 (2 周)

**目标**: 支持平行四边形、矩形、菱形、正方形、梯形

#### 2.1 数据模型和引擎

- [ ] **数据模型**
  - [ ] 定义 `QuadrilateralShape` 类型
  - [ ] 定义 `QuadrilateralProperties` 类型

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/shapes/quadrilateral.ts`
  - [ ] 实现四边形属性计算
  - [ ] 实现特殊四边形判定
    - [ ] 平行四边形判定
    - [ ] 矩形判定
    - [ ] 菱形判定
    - [ ] 正方形判定
    - [ ] 梯形判定

- [ ] **测试**
  - [ ] 单元测试: `quadrilateral.test.ts`
  - [ ] 测试各种四边形的判定逻辑

#### 2.2 UI 和交互

- [ ] **UI 组件**
  - [ ] 在 `ShapePicker` 中添加"四边形"按钮
  - [ ] 创建 `QuadrilateralLayer.tsx`
  - [ ] 创建 `QuadrilateralInfoPanel.tsx`

- [ ] **创建方式**
  - [ ] 任意四边形（点击4个点）
  - [ ] 快速创建矩形（对角两点）
  - [ ] 快速创建正方形（一边 + 方向）
  - [ ] 快速创建平行四边形（三点确定）

- [ ] **辅助工具**
  - [ ] 显示/隐藏对角线
  - [ ] 显示对角线交点
  - [ ] 显示对称轴（矩形、菱形、正方形）

- [ ] **交互逻辑**
  - [ ] 实现四边形的创建
  - [ ] 实现顶点拖动（保持约束）
  - [ ] 实现整体移动
  - [ ] 实现选中/删除

#### 2.3 知识模块

- [ ] **创建四边形知识模块**
  - [ ] 平行四边形的性质
  - [ ] 矩形的性质
  - [ ] 菱形的性质
  - [ ] 正方形的性质
  - [ ] 梯形的性质

- [ ] **互动演示**
  - [ ] 平行四边形对边相等演示
  - [ ] 矩形对角线相等演示
  - [ ] 菱形对角线垂直演示

- [ ] **练习题**
  - [ ] 四边形判定题（5题）
  - [ ] 四边形性质应用题（5题）

**验收标准**:
- ✅ 可以创建各种四边形
- ✅ 四边形类型自动判定准确
- ✅ 属性计算正确
- ✅ 知识模块完整
- ✅ 所有测试通过

---

### 阶段 3: 圆形支持 (1-2 周)

**目标**: 支持圆、扇形、弓形

#### 3.1 圆 (Circle)

- [ ] **数据模型**
  - [ ] 定义 `CircleShape` 类型
  - [ ] 定义 `CircleProperties` 类型

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/shapes/circle.ts`
  - [ ] 实现圆的属性计算
  - [ ] 实现三点定圆算法
  - [ ] 实现圆与直线的交点
  - [ ] 实现两圆的交点

- [ ] **UI 组件**
  - [ ] 在 `ShapePicker` 中添加"圆"按钮
  - [ ] 创建 `CircleLayer.tsx`
  - [ ] 创建 `CircleInfoPanel.tsx`

- [ ] **创建方式**
  - [ ] 圆心 + 半径（点击圆心，拖动半径）
  - [ ] 三点定圆（点击三个点）
  - [ ] 直径两端点（点击两个点）

- [ ] **辅助工具**
  - [ ] 显示圆心
  - [ ] 显示半径
  - [ ] 显示直径
  - [ ] 内接三角形
  - [ ] 内接正方形
  - [ ] 切线

- [ ] **测试**
  - [ ] 单元测试: `circle.test.ts`
  - [ ] 测试圆的各种计算

#### 3.2 扇形和弓形

- [ ] **数据模型**
  - [ ] 定义 `SectorShape` 类型（扇形）
  - [ ] 定义 `ArcShape` 类型（弧）

- [ ] **计算引擎**
  - [ ] 扇形面积和弧长计算
  - [ ] 弓形面积计算

- [ ] **UI 和交互**
  - [ ] 扇形的创建和编辑
  - [ ] 弧的创建和编辑

#### 3.3 知识模块

- [ ] **创建圆的知识模块**
  - [ ] 圆的基本性质
  - [ ] 圆周角定理
  - [ ] 切线的性质
  - [ ] 圆与多边形的关系

- [ ] **互动演示**
  - [ ] 圆周角定理演示
  - [ ] 切线垂直于半径演示
  - [ ] 内接三角形演示

- [ ] **练习题**
  - [ ] 圆的计算题（5题）
  - [ ] 圆周角定理应用题（5题）

**验收标准**:
- ✅ 可以创建圆、扇形、弓形
- ✅ 圆的属性计算正确
- ✅ 圆与其他图形的关系正确
- ✅ 知识模块完整
- ✅ 所有测试通过

---

### 阶段 4: 多边形支持 (1 周)

**目标**: 支持正多边形和不规则多边形

#### 4.1 数据模型和引擎

- [ ] **数据模型**
  - [ ] 定义 `PolygonShape` 类型
  - [ ] 定义 `PolygonProperties` 类型

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/shapes/polygon.ts`
  - [ ] 实现多边形面积计算（鞋带公式）
  - [ ] 实现凸多边形判定
  - [ ] 实现正多边形判定
  - [ ] 实现内角和计算

- [ ] **测试**
  - [ ] 单元测试: `polygon.test.ts`

#### 4.2 UI 和交互

- [ ] **UI 组件**
  - [ ] 在 `ShapePicker` 中添加"多边形"按钮
  - [ ] 创建 `PolygonLayer.tsx`
  - [ ] 创建 `PolygonInfoPanel.tsx`

- [ ] **创建方式**
  - [ ] 不规则多边形（连续点击顶点，双击结束）
  - [ ] 正多边形（圆心 + 半径 + 边数）

- [ ] **交互逻辑**
  - [ ] 实现多边形的创建
  - [ ] 实现顶点拖动
  - [ ] 实现整体移动
  - [ ] 实现选中/删除

#### 4.3 知识模块

- [ ] **创建多边形知识模块**
  - [ ] 多边形的内角和
  - [ ] 正多边形的性质
  - [ ] 多边形的对角线

- [ ] **练习题**
  - [ ] 多边形内角和计算题（3题）
  - [ ] 正多边形性质题（3题）

**验收标准**:
- ✅ 可以创建正多边形和不规则多边形
- ✅ 多边形属性计算正确
- ✅ 知识模块完整
- ✅ 所有测试通过

---

### 阶段 5: 高级功能 (2 周)

**目标**: 图形关系、变换、高级工具

#### 5.1 图形关系

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/relations/` 目录
  - [ ] 实现距离关系计算
  - [ ] 实现角度关系计算
  - [ ] 实现平行关系判定
  - [ ] 实现垂直关系判定
  - [ ] 实现相交关系判定

- [ ] **UI 功能**
  - [ ] 显示两图形之间的距离
  - [ ] 显示两直线的夹角
  - [ ] 高亮平行线
  - [ ] 高亮垂直线

#### 5.2 几何变换

- [ ] **计算引擎**
  - [ ] 创建 `src/engine/core/transform.ts`
  - [ ] 实现平移变换
  - [ ] 实现旋转变换
  - [ ] 实现缩放变换
  - [ ] 实现对称变换

- [ ] **UI 功能**
  - [ ] 图形平移工具
  - [ ] 图形旋转工具
  - [ ] 图形缩放工具
  - [ ] 轴对称工具
  - [ ] 中心对称工具

#### 5.3 高级辅助工具

- [ ] **切线工具**
  - [ ] 圆的切线
  - [ ] 过圆外一点的切线

- [ ] **内接/外接工具**
  - [ ] 三角形的外接圆
  - [ ] 三角形的内切圆
  - [ ] 圆的内接正多边形

- [ ] **轨迹工具**
  - [ ] 点的运动轨迹
  - [ ] 动态演示

#### 5.4 测试

- [ ] 单元测试: `relations/*.test.ts`
- [ ] 单元测试: `transform.test.ts`
- [ ] 集成测试: 复杂图形组合

**验收标准**:
- ✅ 图形关系判定准确
- ✅ 几何变换正确
- ✅ 高级工具可用
- ✅ 所有测试通过

---

### 阶段 6: 知识体系完善 (1 周)

**目标**: 完善所有知识模块和练习题

#### 6.1 知识模块整理

- [ ] **按年级组织**
  - [ ] 小学/初一: 点、线、面基础
  - [ ] 初一: 相交线与平行线、三角形
  - [ ] 初二: 全等三角形、特殊三角形、四边形
  - [ ] 初三: 相似三角形、锐角三角函数、圆、正多边形

- [ ] **每个模块包含**
  - [ ] 核心概念（文字 + 图示）
  - [ ] 公式定理（LaTeX 渲染）
  - [ ] 互动演示（动画）
  - [ ] 练习题（3-5题）

#### 6.2 互动演示动画

- [ ] 点、线、面的基础概念
- [ ] 平行线的性质
- [ ] 三角形内角和
- [ ] 勾股定理
- [ ] 全等三角形判定
- [ ] 相似三角形判定
- [ ] 四边形的性质
- [ ] 圆周角定理
- [ ] 正多边形的性质

#### 6.3 练习题库

- [ ] 每个知识模块 3-5 道题
- [ ] 题目类型: 选择题、填空题、判断题
- [ ] 提供详细解析
- [ ] 答题后显示正确率

**验收标准**:
- ✅ 知识模块覆盖初中所有几何内容
- ✅ 每个模块有完整的演示和练习
- ✅ 动画流畅，解释清晰

---

### 阶段 7: 优化和完善 (1 周)

**目标**: 性能优化、用户体验提升、文档完善

#### 7.1 性能优化

- [ ] **渲染优化**
  - [ ] 实现图层缓存
  - [ ] 实现虚拟化渲染
  - [ ] 优化大量图形的性能

- [ ] **计算优化**
  - [ ] 缓存计算结果
  - [ ] 防抖/节流优化
  - [ ] Web Worker 异步计算

#### 7.2 用户体验

- [ ] **快捷键**
  - [ ] 完善所有快捷键
  - [ ] 快捷键提示

- [ ] **撤销/重做**
  - [ ] 完善历史记录
  - [ ] 支持所有操作的撤销

- [ ] **导入/导出**
  - [ ] 导出为图片（PNG/SVG）
  - [ ] 保存/加载项目文件
  - [ ] 分享功能

#### 7.3 响应式设计

- [ ] **移动端适配**
  - [ ] 触摸交互优化
  - [ ] 底部抽屉面板
  - [ ] 手势支持

- [ ] **平板适配**
  - [ ] 中等屏幕布局
  - [ ] 触控笔支持

#### 7.4 文档和帮助

- [ ] **用户文档**
  - [ ] 快速入门指南
  - [ ] 功能说明文档
  - [ ] 常见问题 FAQ

- [ ] **开发文档**
  - [ ] API 文档
  - [ ] 架构说明
  - [ ] 贡献指南

#### 7.5 测试

- [ ] **E2E 测试**
  - [ ] 完整的用户流程测试
  - [ ] 跨浏览器测试

- [ ] **性能测试**
  - [ ] 大量图形性能测试
  - [ ] 内存泄漏检测

**验收标准**:
- ✅ 性能流畅（60fps）
- ✅ 移动端体验良好
- ✅ 文档完整
- ✅ 测试覆盖率 > 80%

---

## 📊 总体时间估算

| 阶段 | 内容 | 优先级 |
|------|------|--------|
| 阶段 0 | 架构重构 | P0 |
| 阶段 1 | 基础元素（点、线） | P0 |
| 阶段 2 | 四边形 | P0 |
| 阶段 3 | 圆形 | P0 |
| 阶段 4 | 多边形 | P1 |
| 阶段 5 | 高级功能 | P1 |
| 阶段 6 | 知识体系 | P0 |
| 阶段 7 | 优化完善 | P1 |

**总计**: 约 10-12 周（2.5-3 个月）

---

## 🎯 里程碑

### M1: MVP (阶段 0-1 完成)
- 架构重构完成
- 支持点和线段
- 保持三角形功能

### M2: 核心功能 (阶段 2-3 完成)
- 支持四边形
- 支持圆形
- 基础知识模块

### M3: 功能完整 (阶段 4-6 完成)
- 支持多边形
- 高级功能
- 完整知识体系

### M4: 产品化 (阶段 7 完成)
- 性能优化
- 移动端支持
- 文档完善

---

## 🚀 快速启动建议

如果资源有限，建议按以下优先级实施：

### 最小可行产品 (MVP)
1. 阶段 0: 架构重构
2. 阶段 1: 点和线段
3. 阶段 2: 四边形（只做矩形和正方形）
4. 阶段 3: 圆形（只做基础圆）

### 第二阶段
5. 完善四边形（平行四边形、菱形、梯形）
6. 完善圆形（扇形、切线）
7. 添加多边形支持

### 第三阶段
8. 高级功能
9. 知识体系完善
10. 优化和完善

---

## 📝 注意事项

1. **保持向后兼容**: 每个阶段都要确保现有功能不受影响
2. **测试驱动**: 每个新功能都要有对应的测试
3. **代码质量**: 每次提交前运行 `pnpm run check-types` 和 `pnpm run lint`
4. **文档同步**: 代码和文档同步更新
5. **用户反馈**: 每个里程碑后收集用户反馈，调整计划
