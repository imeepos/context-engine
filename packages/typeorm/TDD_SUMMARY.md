# @sker/typeorm TDD å®æ–½æ€»ç»“

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

æŒ‰ç…§ TDD (Test-Driven Development) å·¥ä½œæµç¨‹ï¼ŒæˆåŠŸå®æ–½äº† @sker/typeorm çš„å‰ä¸¤ä¸ªé˜¶æ®µï¼š

### âœ… é˜¶æ®µ 1: æ ¸å¿ƒæŸ¥è¯¢æ„å»ºå™¨
- **æµ‹è¯•å…ˆè¡Œ**: ç¼–å†™äº† 13 ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æŸ¥è¯¢æ„å»ºå™¨åŠŸèƒ½
- **å®ç°åŠŸèƒ½**:
  - `select()` - ç±»å‹å®‰å…¨çš„åˆ—é€‰æ‹©
  - `where()` - æ¡ä»¶è¿‡æ»¤ï¼ˆæ”¯æŒå¯¹è±¡å’Œæ“ä½œç¬¦ï¼‰
  - `orderBy()` - æ’åº
  - `limit()` / `offset()` - åˆ†é¡µ
  - `execute()` - å»¶è¿Ÿæ‰§è¡Œ
  - SQL ç”Ÿæˆå’Œå‚æ•°ç»‘å®š

### âœ… é˜¶æ®µ 2: æ“ä½œç¬¦å‡½æ•°ç³»ç»Ÿ
- **æµ‹è¯•å…ˆè¡Œ**: ç¼–å†™äº† 17 ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æ“ä½œç¬¦
- **å®ç°åŠŸèƒ½**:
  - æ¯”è¾ƒæ“ä½œç¬¦: `eq`, `gt`, `lt`, `gte`, `lte`, `ne`
  - æ¨¡ç³ŠåŒ¹é…: `like`, `ilike`
  - èŒƒå›´æ“ä½œ: `inArray`, `between`
  - ç©ºå€¼æ£€æŸ¥: `isNull`, `isNotNull`
  - é€»è¾‘ç»„åˆ: `and`, `or`, `not`
  - æ”¯æŒåµŒå¥—æ“ä½œç¬¦

### âœ… æµ‹è¯•è¦†ç›–ç‡
- **56 ä¸ªæµ‹è¯•** å…¨éƒ¨é€šè¿‡ (100%)
- **83.33%** ä»£ç è¦†ç›–ç‡ (è¶…è¿‡ 80% è¦æ±‚)
- **91.66%** å‡½æ•°è¦†ç›–ç‡
- **81.48%** åˆ†æ”¯è¦†ç›–ç‡

### âœ… è´¨é‡ä¿è¯
- TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- ESLint ä»£ç è§„èŒƒæ£€æŸ¥é€šè¿‡
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- éµå¾ªä¸å¯å˜æ€§åŸåˆ™

## ğŸ“Š TDD å·¥ä½œæµç¨‹

æˆ‘ä»¬ä¸¥æ ¼éµå¾ªäº† TDD çš„ RED-GREEN-REFACTOR å¾ªç¯ï¼š

1. **RED (å¤±è´¥)**: å…ˆç¼–å†™æµ‹è¯•ï¼ŒéªŒè¯æµ‹è¯•å¤±è´¥
2. **GREEN (é€šè¿‡)**: ç¼–å†™æœ€å°åŒ–ä»£ç ä½¿æµ‹è¯•é€šè¿‡
3. **REFACTOR (é‡æ„)**: ä¼˜åŒ–ä»£ç è´¨é‡

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€æŸ¥è¯¢
```typescript
const users = await repo
  .createQueryBuilder()
  .select('id', 'name', 'email')
  .where({ status: 'active' })
  .orderBy('createdAt', 'DESC')
  .limit(10)
  .execute()
```

### ä½¿ç”¨æ“ä½œç¬¦
```typescript
const users = await repo
  .createQueryBuilder()
  .where(and(
    eq('status', 'active'),
    gt('age', 18),
    or(
      like('email', '%@gmail.com'),
      like('email', '%@outlook.com')
    )
  ))
  .execute()
```

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ query-builder/
â”‚   â”œâ”€â”€ QueryBuilder.ts              # æŸ¥è¯¢æ„å»ºå™¨å®ç°
â”‚   â”œâ”€â”€ types.ts                     # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ QueryBuilder.test.ts         # åŸºç¡€æµ‹è¯•
â”‚   â””â”€â”€ QueryBuilder.operators.test.ts # æ“ä½œç¬¦é›†æˆæµ‹è¯•
â”œâ”€â”€ operators/
â”‚   â”œâ”€â”€ index.ts                     # æ“ä½œç¬¦å‡½æ•°
â”‚   â”œâ”€â”€ types.ts                     # æ“ä½œç¬¦ç±»å‹
â”‚   â”œâ”€â”€ operators.test.ts            # æ¯”è¾ƒæ“ä½œç¬¦æµ‹è¯•
â”‚   â”œâ”€â”€ logical.test.ts              # é€»è¾‘æ“ä½œç¬¦æµ‹è¯•
â”‚   â”œâ”€â”€ pattern.test.ts              # æ¨¡ç³ŠåŒ¹é…æµ‹è¯•
â”‚   â””â”€â”€ integration.test.ts          # é›†æˆæµ‹è¯•
â”œâ”€â”€ decorators/
â”‚   â”œâ”€â”€ index.ts                     # è£…é¥°å™¨å¯¼å‡º
â”‚   â””â”€â”€ decorators.test.ts           # è£…é¥°å™¨æµ‹è¯•
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ Repository.test.ts           # Repository æµ‹è¯•
â””â”€â”€ data-source/
    â””â”€â”€ DataSource.test.ts           # DataSource æµ‹è¯•
```

## ğŸš€ ä¸‹ä¸€æ­¥

å‰©ä½™é˜¶æ®µï¼ˆå¯é€‰å®æ–½ï¼‰ï¼š
- **é˜¶æ®µ 3**: ç±»å‹æ¨å¯¼ä¼˜åŒ– - ç²¾ç¡®çš„è¿”å›ç±»å‹
- **é˜¶æ®µ 4**: æ‰¹é‡æ“ä½œ - saveMany, updateMany, removeMany
- **é˜¶æ®µ 5**: äº‹åŠ¡æ”¯æŒ - åŸºäº D1 batch API
- **é˜¶æ®µ 6**: æ€§èƒ½ä¼˜åŒ– - SQL ç¼“å­˜

## ğŸ“ å…³é”®å†³ç­–

1. **æµ‹è¯•æ¡†æ¶**: é€‰æ‹© Vitestï¼ˆå¿«é€Ÿã€ç°ä»£ã€ä¸ Vite é›†æˆï¼‰
2. **æµ‹è¯•ç­–ç•¥**: TDD å…ˆè¡Œï¼Œç¡®ä¿ä»£ç è´¨é‡
3. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ TypeScript æ³›å‹ç¡®ä¿ç±»å‹æ¨å¯¼
4. **ä¸å¯å˜æ€§**: æ‰€æœ‰æ–¹æ³•è¿”å› thisï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
5. **SQL å®‰å…¨**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥

## âœ¨ æˆæœ

é€šè¿‡ TDD å·¥ä½œæµç¨‹ï¼Œæˆ‘ä»¬ï¼š
- âœ… ç¡®ä¿äº†ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
- âœ… è¾¾åˆ°äº† 83.33% çš„æµ‹è¯•è¦†ç›–ç‡
- âœ… å®ç°äº†ç±»å‹å®‰å…¨çš„æŸ¥è¯¢æ„å»ºå™¨
- âœ… æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦å‡½æ•°
- âœ… ä¿æŒäº†ä»£ç ç®€æ´æ€§ï¼ˆçº¦ 400 è¡Œæ ¸å¿ƒä»£ç ï¼‰
